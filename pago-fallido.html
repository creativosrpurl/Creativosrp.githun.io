<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pago Fallido - Creativos RP</title>
  <link rel="icon" href="logos/logo-gta-san-andreas.jpg" type="image/jpeg">

  <!-- Fuentes y estilos -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Permanent+Marker&family=Rajdhani:wght@600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">

  <style>
    /* Estilos específicos para esta página de estado */
    .status-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      text-align: center;
      padding: 2rem;
    }
    .status-box {
      max-width: 600px;
      border-color: #d9534f; /* Un color rojo para indicar error */
    }
    .status-box .gta-section-title {
        color: #d9534f; /* Rojo */
    }
    .receipt-table {
      width: 100%;
      margin-top: 2rem;
      text-align: left;
      border-collapse: collapse;
    }
    .receipt-table td {
      padding: 0.75rem;
      border-bottom: 1px solid #444;
      color: #fff;
    }
    .receipt-table td:first-child {
      color: #FFD700;
      font-weight: bold;
    }
    .receipt-table tr:last-child td {
      border-bottom: none;
    }
  </style>
</head>
<body>
  <div id="gta-bg" aria-hidden="true"></div>

  <main class="status-container">
    <div class="status-box gta-section">
      <h1 id="status-title" class="gta-section-title">Transacción Fallida</h1>
      <p id="status-message" class="gta-text">
        La transacción no se pudo completar. No se ha realizado ningún cargo a tu cuenta.
      </p>

      <!-- Tabla de detalles de la compra -->
      <table id="receipt-container" class="receipt-table" hidden>
        <tbody>
          <tr><td>Usuario SA-MP:</td><td id="receipt-username">--</td></tr>
          <tr><td>Producto:</td><td id="receipt-item">--</td></tr>
          <tr><td>Monto:</td><td id="receipt-amount">--</td></tr>
          <tr><td>Fecha del Intento:</td><td id="receipt-date">--</td></tr>
        </tbody>
      </table>

      <a href="index.html" class="gta-boton" style="margin-top: 2rem;">Volver a la tienda</a>
    </div>
  </main>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const urlParams = new URLSearchParams(window.location.search);
      const reason = urlParams.get('reason');
      const username = urlParams.get('username');
      const itemName = urlParams.get('itemName');
      const amount = urlParams.get('amount');
      const currency = urlParams.get('currency');
      const date = new Date(); // Usamos la fecha actual para el intento

      const statusTitle = document.getElementById('status-title');
      const statusMessage = document.getElementById('status-message');

      if (reason === 'fondos_insuficientes') {
        statusTitle.textContent = 'Fondos Insuficientes';
        statusMessage.textContent = 'El pago fue declinado por tu banco o por PayPal. Por favor, verifica los fondos de tu método de pago e inténtalo de nuevo.';
      } else if (reason === 'cancelado') {
        document.getElementById('status-title').textContent = 'Pago Cancelado';
        document.getElementById('status-message').textContent = 'Has cancelado el proceso de pago. Puedes volver a la tienda e intentarlo de nuevo cuando quieras.';
      }

      // Si hay datos del intento de compra, los mostramos
      if (username && itemName && amount) {
        document.getElementById('receipt-container').hidden = false;
        document.getElementById('receipt-username').textContent = username;
        document.getElementById('receipt-item').textContent = itemName;
        
        const formatOptions = { style: 'currency', currency: currency || 'USD', minimumFractionDigits: (currency === 'COP' ? 0 : 2) };
        const locale = currency === 'COP' ? 'es-CO' : 'en-US';
        document.getElementById('receipt-amount').textContent = new Intl.NumberFormat(locale, formatOptions).format(amount);

        const dateOptions = { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' };
        document.getElementById('receipt-date').textContent = date.toLocaleDateString('es-ES', dateOptions);
      }
    });
  </script>
</body>
</html>
